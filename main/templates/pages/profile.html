{% extends 'base/base.html' %}

{% block title %}
  {{ pagename }}
{% endblock %}

{% block heading %}
  Профиль
{% endblock %}

{% block content %}
  <div class="row g-3">
    <div class="col">
      <div class="container">
        <img src="/media/{{ user.profile.profile_image }}" class="img-fluid">
        {% if user == request.user%}

        <a href="/profile_edit/">Редактировать профиль</a>

        {% if request.user.is_staff or request.user.is_superuser %}
          <br>
          <a href="/admin/">Перейти на страницу администратора</a>
        {%endif%}
        {% elif request.user.is_superuser and not user.is_superuser and not user.is_staff%}
        <form method="post">
          {% csrf_token %}
          <button class="btn btn-secondary" type="submit" name="action" value="set_moder">Назначить модератора</button>
        </form>

        {% elif request.user.is_superuser and user.is_staff and not user.is_superuser %}
        <form method="post">
          {% csrf_token %}
          <button class="btn btn-secondary" type="submit" name="action" value="reset_moder">Снять модератора</button>
        </form>


        {%endif%}
      </div>
    </div>

    <div class="col">
      <div class="container">
        <dl class="row">
          <dt class="col-md-auto">Имя:</dt>
          <dd class="col-md-auto">{{user.username}}</dd>
        </dl>
        <dl class="row">
          <dt class="col-md-auto">Email:</dt>
          <dd class="col-md-auto">{{user.email}}</dd>
        </dl>
        <br>
        <dl class="row">
          <dt class="col-md-auto">Количество созданных голосований:</dt>
          <dd class="col-md-auto">{{votings.count}}</dd>
        </dl>
        <dl class="row">
          <dt class="col-md-auto">Количество голосов:</dt>
          <dd class="col-md-auto">{{votes.count}}</dd>
        </dl>
        <dl class="row">
          <dt class="col-md-auto">Количество жалоб:</dt>
          <dd class="col-md-auto">{{complaints.count}}</dd>
        </dl>
      </div>
    </div>
    <div class="col">
      <div class="container">
        <dl class="row">
          <a href="{%url 'votings_list' %}?user={{user.id}}">
            <button class="btn btn-secondary" type="button">Созданные голосования</button>
          </a>
        </dl>
        <dl class="row">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
                    data-bs-toggle="dropdown" aria-expanded="false">
              Жалобы
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              {%for com in complaints%}
              <li><a class="dropdown-item" href="{% url 'complaint' com.id %}">Голосование '{{com.voting.name}}'</a></li>
              {%endfor%}
            </ul>
          </div>
        </dl>
        <dl class="row">
          <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2"
                    data-bs-toggle="dropdown" aria-expanded="false">
              Голоса
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
              {%for vote in votes%}
              <li><a class="dropdown-item" href="{% url 'voting_page' vote.variants.first.voting.id %}">Голосование '{{vote.variants.first.voting.name}}'</a></li>
              {%endfor%}
            </ul>
          </div>
        </dl>
      </div>
    </div>
  </div>
{% endblock %}
